// Check which values exist
proc freq data=work.&dataset_name;
    tables period*typ_op / missing;
    title "Check typ_op values per Pandemic Phase";
run;


// Robust Solution Anteil OP per Pandemiephase
title "Proportion of Cases with Surgery per Pandemic Phase (Robust)";
proc sql;
    select period,
           sum(case when typ_op = 1 then 1 else 0 end) as Surgery_Cases,
           count(*) as Total_Cases,
           calculated Surgery_Cases * 100.0 / calculated Total_Cases as Percent_Surgery format=6.2
    from work.&dataset_name
    group by period
    order by period;
quit;


// Proportion Female Cases

title "Proportion of Female Cases per Pandemic Phase";
proc sql;
    select period,
           sum(case when sex_grouped = 'Female' then 1 else 0 end) as Female_Cases,
           count(*) as Total_Cases,
           calculated Female_Cases * 100.0 / calculated Total_Cases as Percent_Female format=6.2
    from work.&dataset_name
    group by period
    order by period;
quit;



Gruppieren Fallzahlen:
Nord: HH, SH    ==== 01, 02
Süd: BY         ==== 09
West: NRW       ==== 05
Ost: BER, BRA   ==== 11, 12


01 = Schleswig-Holstein
02 = Hamburg
03 = Niedersachsen
04 = Bremen
05 = Nordrhein-Westfalen
06 = Hessen
07 = Rheinland-Pfalz
08 = Baden-Württemberg
09 = Bayern
10 = Saarland
11 = Berlin
12 = Brandenburg
13 = Mecklenburg-Vorpommern
14 = Sachsen
15 = Sachsen-Anhalt
16 = Thüringen






data work.&dataset_name;
    set work.&dataset_name;

    length region_group $10;

    /* Assign region based on kh_land */
    if kh_land in ('01', '02') then region_group = 'Nord';
    else if kh_land = '05' then region_group = 'West';
    else if kh_land = '09' then region_group = 'Süd';
    else if kh_land in ('11', '12') then region_group = 'Ost';
    else region_group = 'Rest';  /* All other Bundesländer */

run;



title "Number of Cases per Region Group";
proc sql;
    select region_group, count(*) as Number_of_Cases
    from work.&dataset_name
    group by region_group
    order by region_group;
quit;


title "Number of Cases per Region and Pandemic Phase";
proc sql;
    select period, region_group, count(*) as Number_of_Cases
    from work.&dataset_name
    group by period, region_group
    order by period, region_group;
quit;



Numeric grouping if neccessary:
data work.&dataset_name;
    set work.&dataset_name;

    /* Convert kh_land to numeric if it’s character */
    kh_land_num = input(kh_land, 2.);  /* Creates a numeric version */

run;
data work.&dataset_name;
    set work.&dataset_name;

    length region_group $10;

    if kh_land_num in (1, 2) then region_group = 'Nord';
    else if kh_land_num = 5 then region_group = 'West';
    else if kh_land_num = 9 then region_group = 'Süd';
    else if kh_land_num in (11, 12) then region_group = 'Ost';
    else region_group = 'Rest';
run;
title "Number of Cases per Region Group";
proc sql;
    select region_group, count(*) as Number_of_Cases
    from work.&dataset_name
    group by region_group
    order by region_group;
quit;
